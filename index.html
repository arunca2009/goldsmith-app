<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Goldsmith Billing</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:10px}
.box{background:#fff;padding:15px;border-radius:10px;max-width:520px;margin:auto}
input,select,button{width:100%;padding:10px;margin-top:8px;font-size:15px}
button{background:#0a7cff;color:white;border:none;border-radius:6px}
.section{background:#f7f7f7;padding:10px;margin-top:10px;border-radius:6px}
h2{text-align:center}
</style>
</head>

<body>

<script>
if(prompt("Enter Password")!=="1234"){
 document.body.innerHTML="ACCESS DENIED";
}
</script>

<div class="box">

<h2>SRI MARUTHAMALAI JEWELS WORKS</h2>

<div class="section">
<input id="name" placeholder="Customer Name">
<input id="phone" placeholder="Phone Number">
</div>

<div class="section">
<select id="item">
<option>Ring</option>
<option>Necklace</option>
<option>Bangle</option>
<option>Chain</option>
</select>

<input id="purity" placeholder="New Gold Purity (%)">
<input id="weight" placeholder="Weight (g)">
<input id="rate" placeholder="Gold Rate per gram">
<input id="making" placeholder="Making Charge">
<input id="newWastage" placeholder="New Gold Wastage (Rs.)">
<input id="stone" placeholder="Stone Charge">
<input id="hallmark" placeholder="Hallmark Charge">
<input id="advance" placeholder="Advance Paid">
</div>

<div class="section">
<select id="oldGiven" onchange="toggleOldGold()">
<option value="no">Old Gold Given? NO</option>
<option value="yes">Old Gold Given? YES</option>
</select>
</div>

<div class="section" id="oldSection" style="display:none">
<input id="oldTouch" placeholder="Old Gold Purity (%)">
<input id="oldWeight" placeholder="Old Gold Weight (g)">
<input id="oldRate" placeholder="Old Gold Rate">
<input id="oldWastage" placeholder="Old Gold Wastage (Rs.)">
</div>

<button type="button" onclick="calculate()">CALCULATE</button>

<h3 id="result">Final Payable: Rs. 0</h3>
<h3 id="balance">Balance: Rs. 0</h3>

<button type="button" onclick="saveOrder()">SAVE ORDER</button>
<button type="button" onclick="shareInvoice()">SHARE INVOICE</button>
<button type="button" onclick="generatePDF()">DOWNLOAD PDF</button>

</div>

<script>

/* TOGGLE */
function toggleOldGold(){
 document.getElementById("oldSection").style.display =
 document.getElementById("oldGiven").value==="yes" ? "block":"none";
}

/* CALCULATE */
function calculate(){

 let w=Number(weight.value);
 let p=Number(purity.value);
 let r=Number(rate.value);
 let m=Number(making.value);
 let nw=Number(newWastage.value);
 let s=Number(stone.value);
 let h=Number(hallmark.value);
 let adv=Number(advance.value);

 let ow=Number(oldWeight.value);
 let ot=Number(oldTouch.value);
 let orate=Number(oldRate.value);
 let owast=Number(oldWastage.value);

 let newTotal=((w*(p/100))*r)+m+nw+s+h;

 let oldValue=((ow*(ot/100))*orate)-owast;
 if(oldValue<0) oldValue=0;

 let final=newTotal-oldValue;
 if(final<0) final=0;

 let bal=final-adv;
 if(bal<0) bal=0;

 result.innerText="Final Payable: Rs. "+final.toFixed(2);
 balance.innerText="Balance: Rs. "+bal.toFixed(2);
}

/* SAVE */
function saveOrder(){

 let url=
"https://script.google.com/macros/s/AKfycbz4utLXErNoVjLOjPfVAIl--s-5EEXhQDD0yGCGeUqZq3jDTPcgXy17rgS1lTBex6PD/exec"+
"?name="+encodeURIComponent(name.value)+
"&phone="+encodeURIComponent(phone.value)+
"&final="+encodeURIComponent(result.innerText)+
"&balance="+encodeURIComponent(balance.innerText);

 fetch(url)
 .then(r=>r.text())
 .then(t=>alert(t))
 .catch(e=>alert("Save Failed"));
}

/* SHARE */
function shareInvoice(){
 let msg="INVOICE\n"+result.innerText+"\n"+balance.innerText;
 window.open("https://wa.me/?text="+encodeURIComponent(msg));
}

/* PDF */
function generatePDF(){

 if(!window.jspdf){
  alert("Internet required first time");
  return;
 }

 const {jsPDF}=window.jspdf;
 const doc=new jsPDF();

 let now=new Date();

 doc.setFontSize(16);
 doc.text("SRI MARUTHAMALAI JEWELS WORKS",20,20);
 doc.setFontSize(12);
 doc.text("Customer: "+name.value,20,40);
 doc.text("Phone: "+phone.value,20,50);
 doc.text(result.innerText,20,70);
 doc.text(balance.innerText,20,80);
 doc.text("Date: "+now.toLocaleDateString(),20,100);
 doc.text("Time: "+now.toLocaleTimeString(),20,110);

 doc.save("Invoice.pdf");
}

</script>

</body>
</html>
