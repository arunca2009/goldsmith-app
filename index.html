<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Goldsmith System</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
 font-family: Arial, sans-serif;
 background:#f2f2f2;
 padding:10px;
 margin:0;
}
.box{
 background:#ffffff;
 padding:15px;
 border-radius:12px;
 max-width:520px;
 margin:auto;
}
h2{text-align:center;}
input,select,button{
 width:100%;
 padding:12px;
 margin-top:8px;
 font-size:16px;
 border-radius:8px;
 border:1px solid #ccc;
}
button{
 background:#0a7cff;
 color:white;
 border:none;
 font-size:17px;
}
.section{
 background:#f7f7f7;
 padding:10px;
 border-radius:8px;
 margin-top:12px;
}
</style>
</head>

<body>

<script>
if(prompt("Enter Password")!="1234"){
 document.body.innerHTML="ACCESS DENIED";
}
</script>

<div class="box">

<h2>Jewellery Billing System</h2>

<div class="section">
<input id="name" placeholder="Customer Name">
<input id="phone" placeholder="Phone Number">
</div>

<div class="section">
<select id="item">
<option>Ring</option>
<option>Necklace</option>
<option>Bangle</option>
<option>Chain</option>
<option>Bracelet</option>
</select>

<select id="purity">
<option>22K</option>
<option>18K</option>
</select>

<input id="weight" placeholder="New Gold Weight (g)" inputmode="decimal">
<input id="rate" placeholder="Gold Rate per gram" inputmode="decimal">
<input id="making" placeholder="Making Charge" inputmode="decimal">
<input id="stone" placeholder="Stone Charge" inputmode="decimal">
<input id="hallmark" placeholder="Hallmark Charge" inputmode="decimal">
<input id="advance" placeholder="Advance Paid" inputmode="decimal">
</div>

<div class="section">
<h3>Old Gold Exchange</h3>
<input id="oldWeight" placeholder="Old Gold Weight (g)" inputmode="decimal">
<select id="oldTouch">
<option value="0">Select Old Gold Touch</option>
<option value="91.6">22K</option>
<option value="75">18K</option>
<option value="100">24K</option>
</select>
<input id="oldRate" placeholder="Old Gold Rate per gram" inputmode="decimal">
<input id="oldWastage" placeholder="Wastage (%)" inputmode="decimal">
</div>

<button onclick="calculate()">CALCULATE</button>

<h3 id="result">Final Payable: Rs. 0</h3>
<h3 id="oldvalue">Old Gold Value: Rs. 0</h3>
<h3 id="balance">Balance: Rs. 0</h3>

<button onclick="saveOrder()">SAVE ORDER</button>
<button onclick="shareInvoice()">SHARE INVOICE</button>
<button onclick="generatePDF()">DOWNLOAD PDF</button>

</div>

<script>

/* CALCULATION */
function calculate(){

 let w=Number(weight.value);
 let r=Number(rate.value);
 let m=Number(making.value);
 let s=Number(stone.value);
 let h=Number(hallmark.value);
 let adv=Number(advance.value);

 let newTotal = (w*r)+m+s+h;

 let ow=Number(oldWeight.value);
 let ot=Number(oldTouch.value);
 let orate=Number(oldRate.value);
 let wast=Number(oldWastage.value);

 let pure = ow*(ot/100);
 let finalPure = pure-(pure*(wast/100));
 let oldGoldValue = finalPure*orate;

 let finalAmount = newTotal-oldGoldValue;
 let bal = finalAmount-adv;

 result.innerText="Final Payable: Rs. "+finalAmount.toFixed(2);
 oldvalue.innerText="Old Gold Value: Rs. "+oldGoldValue.toFixed(2);
 balance.innerText="Balance: Rs. "+bal.toFixed(2);
}

/* SAVE TO GOOGLE SHEET */
function saveOrder(){

 let w=Number(weight.value);
 let r=Number(rate.value);
 let m=Number(making.value);
 let s=Number(stone.value);
 let h=Number(hallmark.value);
 let adv=Number(advance.value);

 let ow=Number(oldWeight.value);
 let ot=Number(oldTouch.value);
 let orate=Number(oldRate.value);
 let wast=Number(oldWastage.value);

 let newTotal=(w*r)+m+s+h;
 let pure=ow*(ot/100);
 let finalPure=pure-(pure*(wast/100));
 let oldGoldValue=finalPure*orate;

 let finalAmount=newTotal-oldGoldValue;
 let bal=finalAmount-adv;

 let url="https://script.google.com/macros/s/AKfycby3a5yDFAusdH6Q9bG6A-qkuAdIw-bYcppPwmHs3qZcWW4qqqj_tzBLN62GoV-iIPsb/exec"+
 "?name="+encodeURIComponent(document.getElementById("name").value)+
 "&phone="+encodeURIComponent(document.getElementById("phone").value)+
 "&item="+item.value+
 "&purity="+purity.value+
 "&weight="+w+
 "&rate="+r+
 "&making="+m+
 "&stone="+s+
 "&hallmark="+h+
 "&oldweight="+ow+
 "&oldtouch="+ot+
 "&oldrate="+orate+
 "&oldwastage="+wast+
 "&oldvalue="+oldGoldValue+
 "&final="+finalAmount+
 "&advance="+adv+
 "&balance="+bal;

 window.open(url);
 alert("Saved Successfully");
}

/* SHARE WHATSAPP */
function shareInvoice(){

 let msg=
"JEWELLERY INVOICE\n"+
"Customer: "+document.getElementById("name").value+"\n"+
"Item: "+item.value+"\n"+
"Final Payable: Rs. "+result.innerText.split("Rs. ")[1];

 window.open("https://wa.me/?text="+encodeURIComponent(msg));
}

/* PDF */
function generatePDF(){

 if(!window.jspdf){
   alert("Connect to internet once for PDF");
   return;
 }

 const { jsPDF } = window.jspdf;
 const doc = new jsPDF();

 let w = Number(weight.value);
 let r = Number(rate.value);
 let m = Number(making.value);
 let s = Number(stone.value);
 let h = Number(hallmark.value);
 let adv = Number(advance.value);

 let ow = Number(oldWeight.value);
 let ot = document.getElementById("oldTouch").options[
           document.getElementById("oldTouch").selectedIndex].text;
 let orate = Number(oldRate.value);

 let total = (w*r)+m+s+h;

 let pure = ow * (Number(document.getElementById("oldTouch").value)/100);
 let oldGoldValue = pure * orate;

 let finalAmount = total - oldGoldValue;
 let bal = finalAmount - adv;

 const img = new Image();
 img.src = "logo.png";

 img.onload = function(){

  // ===== HEADER =====
  doc.addImage(img,"PNG",10,8,25,25);

  doc.setFontSize(14);
  doc.text("SRI MARUTHAMALAI JEWELS WORKS",40,15);
  doc.setFontSize(10);
  doc.text("Custom Jewellery Designers",40,21);
  doc.text("Phone: 9865739322",40,26);

  doc.setFontSize(13);
  doc.text("INVOICE",90,38);

  doc.line(10,42,200,42);

  // ===== CUSTOMER INFO =====
  doc.setFontSize(11);
  doc.text("Customer: "+document.getElementById("name").value,10,52);
  doc.text("Phone: "+document.getElementById("phone").value,10,60);
  doc.text("Item: "+item.value,120,52);
  doc.text("Purity: "+purity.value,120,60);
  doc.text("Weight: "+w+" g",10,68);
  doc.text("Gold Rate: Rs. "+r,120,68);

  doc.line(10,72,200,72);

  // ===== TABLE HEADER =====
  doc.setFontSize(11);
  doc.text("Description",15,82);
  doc.text("Amount (Rs.)",150,82);

  doc.line(10,85,200,85);

  let y = 95;

  function row(name,value){
    doc.text(name,15,y);
    doc.text("Rs. "+value,150,y);
    y += 10;
  }

  row("Gold Value", (w*r));
  row("Making Charge", m);
  row("Stone Charge", s);
  row("Hallmark Charge", h);

  doc.line(10,y-5,200,y-5);

  row("TOTAL", total);

  // ===== OLD GOLD SECTION =====
  y += 5;
  doc.setFontSize(11);
  doc.text("Old Gold Details",15,y);
  y += 10;

  row("Old Gold Weight", ow+" g");
  row("Old Gold Touch", ot);
  row("Old Gold Rate", orate);
  row("Old Gold Value", oldGoldValue.toFixed(2));

  doc.line(10,y-5,200,y-5);

  // ===== FINAL SUMMARY =====
  row("Advance Paid", adv);
  row("Balance Amount", bal.toFixed(2));

  doc.line(10,y+2,200,y+2);

  doc.setFontSize(10);
  doc.text("Thank you for your business!",70,y+15);

  doc.save("Invoice.pdf");
 };

}

</script>

</body>
</html>


